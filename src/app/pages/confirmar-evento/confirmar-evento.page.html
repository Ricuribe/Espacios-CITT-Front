<ion-header class="main-header" [translucent]="true">
  <ion-toolbar class="main-toolbar">
    <ion-buttons slot="start" class="mobile-only-button">
      <ion-menu-button color="light" menu="menu-confirmar"></ion-menu-button>
    </ion-buttons>
    <a href="/inicio-usuario" class="logo-link">
    <img src="/assets/icon/Gemvirt_logo.png" alt="Logo" class="logo">
    </a>

    <ion-buttons slot="end" class="desktop-only-buttons">
      <ion-chip class="user-chip">
        <ion-avatar>
          <img src="https://ionicframework.com/docs/img/demos/avatar.svg" alt="Avatar" />
        </ion-avatar>
        <ion-label>{{ userName }}</ion-label>
      </ion-chip>
      <ion-button class="btn-logout" fill="solid" color="light" (click)="logout()">Cerrar Sesión</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-menu contentId="confirmar-content" type="overlay" menuId="menu-confirmar">
  <ion-header>
    <ion-toolbar>
      <ion-title>Menú</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list lines="none">
      <ion-item button [routerLink]="['/inicio-usuario']"><ion-icon name="home-outline" slot="start"></ion-icon><ion-label>Inicio</ion-label></ion-item>
      <ion-item button [routerLink]="['/recursos']"><ion-icon name="folder-open-outline" slot="start"></ion-icon><ion-label>Recursos</ion-label></ion-item>
      <ion-item button [routerLink]="['/proyectos']"><ion-icon name="library-outline" slot="start"></ion-icon><ion-label>Memorias</ion-label></ion-item>
      <ion-item button (click)="logout()" class="logout-item"><ion-icon name="log-out-outline" slot="start"></ion-icon><ion-label>Cerrar Sesión</ion-label></ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-content [fullscreen]="true" id="confirmar-content" class="confirmar-content">
  
  <div class="page-wrapper">
    
    <div class="nav-header">
      <ion-button fill="clear" class="back-btn" (click)="volver()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
        <span class="back-text">VOLVER</span>
      </ion-button>
    </div>

    <div class="header-section">
      <h1>Confirmar Reserva</h1>
      <p>Revisa los detalles antes de finalizar.</p>
    </div>

    <div class="content-card-wrapper">
      
      <ion-card class="summary-card">
        
        <div class="card-top">
          <ion-icon name="document-text-outline" class="header-icon"></ion-icon>
          <h2>Resumen del Evento</h2>
        </div>

        <div class="card-body">
          
          <div class="info-grid">
            <div class="info-item">
              <ion-icon name="calendar-outline"></ion-icon>
              <div>
                <label>Fecha</label>
                <span>{{ reserva?.fecha | date:'fullDate' }}</span>
              </div>
            </div>
            <div class="info-item">
              <ion-icon name="time-outline"></ion-icon>
              <div>
                <label>Hora Inicio</label>
                <span class="highlight">{{ reserva?.hora }} hrs</span>
              </div>
            </div>
            <div class="info-item">
              <ion-icon name="time-outline"></ion-icon>
              <div>
                <label>Duración</label>
                <span>{{ reserva?.duracion }} min</span>
              </div>
            </div>
            <div class="info-item">
              <ion-icon name="people-outline"></ion-icon>
              <div>
                <label>Espacios</label>
                <span>{{ workspaceIds.length || 1 }} seleccionados</span>
              </div>
            </div>
          </div>

          <hr class="divider">

          <div class="form-container">
            
            <ion-item class="custom-input">
              <ion-label position="stacked">Título del Evento <span style="color: #ef4444">*</span></ion-label>
              <ion-input [(ngModel)]="form.title" placeholder="Ej: Reunión de equipo"></ion-input>
            </ion-item>

            <ion-item class="custom-input">
              <ion-label position="stacked">Tipo de Evento <span style="color: #ef4444">*</span></ion-label>
              <ion-input [(ngModel)]="form.event_type" placeholder="Ej: Taller, Charla, Clase..."></ion-input>
            </ion-item>

            <ion-item class="custom-input">
              <ion-label position="stacked">
                Asistentes estimados 
                <span *ngIf="maxAttendees > 0" style="font-weight:normal; font-size:0.8em; color:#6b7280;">(Máx: {{maxAttendees}})</span>
              </ion-label>
              <ion-input type="number" min="1" [(ngModel)]="form.attendees" placeholder="Ej: 4"></ion-input>
            </ion-item>

            <ion-item class="custom-input toggle-item" lines="none">
              <ion-label>
                Generar Invitación Pública
                <p style="font-size: 0.8em; color: #6b7280; margin-top: 2px;">Crea un enlace QR para inscripción externa</p>
              </ion-label>
              <ion-toggle [(ngModel)]="form.create_invitation" slot="end" color="primary"></ion-toggle>
            </ion-item>

            <ion-item class="custom-input area">
              <ion-label position="stacked">Descripción <span style="color: #ef4444">*</span></ion-label>
              <ion-textarea [(ngModel)]="form.description" rows="3" placeholder="Detalles del evento..."></ion-textarea>
            </ion-item>
          </div>

          <div class="action-area">
            <button class="btn-confirm-final" (click)="confirmarFinal()" [disabled]="isLoading">
              <span *ngIf="!isLoading">CONFIRMAR Y FINALIZAR</span>
              <span *ngIf="isLoading">
                <ion-spinner name="dots" style="vertical-align: middle; margin-right: 8px;"></ion-spinner>
                PROCESANDO...
              </span>
            </button>
          </div>

        </div>
      </ion-card>

    </div>

  </div>

  <app-footer></app-footer>

</ion-content>