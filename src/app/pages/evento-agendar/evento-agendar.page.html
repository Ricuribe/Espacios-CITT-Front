<!-- HEADER -->
<ion-header class="main-header" [translucent]="true">
  <ion-toolbar class="main-toolbar">
    <!-- Botón Menú Móvil -->
    <ion-buttons slot="start" class="mobile-only-button">
      <ion-menu-button color="light" menu="menu-agendar"></ion-menu-button>
    </ion-buttons>

    <!-- Logo -->
     <a [routerLink]="['/inicio-usuario']" class="logo-container">
    <img src="/assets/icon/Gemvirt_logo.png" alt="Logo" class="logo">
      </a>

    <!-- Botones Escritorio -->
    <ion-buttons slot="end" class="desktop-only-buttons">
      <ion-button fill="clear" color="light" [routerLink]="['/inicio-usuario']">Inicio</ion-button>
      <ion-button class="btn-logout" fill="solid" color="light" (click)="logout()">Cerrar Sesión</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<!-- MENÚ LATERAL -->
<ion-menu contentId="agendar-content" type="overlay" menuId="menu-agendar">
  <ion-header>
    <ion-toolbar>
      <ion-title>Menú</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list lines="none">
      <ion-item button [routerLink]="['/inicio-usuario']"><ion-icon name="home-outline" slot="start"></ion-icon><ion-label>Inicio</ion-label></ion-item>
      <ion-item button [routerLink]="['/recursos']"><ion-icon name="folder-open-outline" slot="start"></ion-icon><ion-label>Recursos</ion-label></ion-item>
      <ion-item button [routerLink]="['/proyectos']"><ion-icon name="library-outline" slot="start"></ion-icon><ion-label>Memorias</ion-label></ion-item>
      <ion-item button (click)="logout()" class="logout-item"><ion-icon name="log-out-outline" slot="start"></ion-icon><ion-label>Cerrar Sesión</ion-label></ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<!-- CONTENIDO -->
<ion-content [fullscreen]="true" id="agendar-content" class="agendar-content">
  
  <div class="page-wrapper">
    
    <!-- Botón Volver -->
    <div class="nav-header">
      <ion-button [routerLink]="['/inicio-usuario']" fill="clear" class="back-btn">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
        <span class="back-text">VOLVER</span>
      </ion-button>
    </div>

    <div class="header-section">
      <h1>Selecciona el horario</h1>
    </div>

    <div class="steps-container">
      
      <!-- PASO 1: FECHA -->
      <div class="step-card">
        <h3>1. Elige una fecha</h3>
        <div class="calendar-wrapper">
          <ion-datetime 
            presentation="date"
            [value]="selectedDate()" 
            [min]="todayISO" 
            [max]="maxDateISO"
            [isDateEnabled]="isDateSelectable"
            (ionChange)="handleDateChange($event)"
            [disabled]="loadingSlots()"
            color="primary"
            mode="md">
          </ion-datetime>
        </div>
      </div>

      <!-- PASO 2: DURACIÓN -->
      <div class="step-card">
        <h3>2. Elige la duración</h3>
        <div class="range-wrapper">
          <div class="range-labels">
            <span>30 min</span>
            <span>{{ selectedDuration() }} min</span>
            <span>120 min</span>
          </div>
          <ion-range 
            [min]="30" [max]="120" [step]="30" [snaps]="true" [ticks]="true"
            [value]="selectedDuration()" 
            (ionChange)="handleDurationChange($event)"
            [disabled]="loadingSlots()"
            color="primary">
          </ion-range>
        </div>
      </div>

      <!-- PASO 3: HORA -->
      <div class="step-card">
        <h3>3. Elige una hora</h3>
        
        <div *ngIf="loadingSlots()" class="slots-loader">
          <ion-skeleton-text animated style="width: 100px; height: 40px; border-radius: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 100px; height: 40px; border-radius: 8px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 100px; height: 40px; border-radius: 8px;"></ion-skeleton-text>
        </div>

        <div *ngIf="!loadingSlots()" class="slots-grid">
          @for (slot of slots(); track $index) {
            <button 
              class="slot-btn" 
              [class.selected]="selectedSlot() === slot"
              (click)="selectSlot(slot)">
              {{ slot }}
            </button>
          }
        </div>
        
        <div *ngIf="!loadingSlots() && slots().length === 0" class="no-slots">
          <p>No hay horarios disponibles para esta fecha.</p>
        </div>
      </div>

      <!-- BOTÓN FINAL -->
      <div class="confirm-action">
        <button 
          class="btn-confirm-large" 
          [disabled]="!selectedSlot()"
          (click)="confirmarReserva()">
          CONFIRMAR RESERVA
        </button>
      </div>

    </div>

  </div>

  <app-footer></app-footer>

</ion-content>