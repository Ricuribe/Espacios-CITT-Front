<ion-header>
  <ion-toolbar>
    <ion-title>Selecciona los Espacios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="page-content">
  <div class="page-outer">
    <div class="container">
      <!-- debug banner removed -->
      <!-- Selector de todos los espacios (cuadro superior) -->
      <div class="top-box">
        <ion-item class="select-all-item">
          <ion-label>Seleccionar todos los espacios disponibles</ion-label>
          <ion-toggle
            [(ngModel)]="selectAllEnabled"
            (ionChange)="toggleSelectAll($event)"
          ></ion-toggle>
        </ion-item>
      </div>

      <div class="room-title">
        <p>Vista general de la sala</p>
      </div>

    <!-- Loader -->
    <div *ngIf="isLoading" class="loader-container">
      <ion-spinner></ion-spinner>
      <p>Cargando espacios...</p>
    </div>

    <!-- Mensaje de Error -->
    <div *ngIf="!isLoading && error" class="error-container">
      <ion-text color="danger">
        <p>Error al cargar los espacios. Intenta de nuevo más tarde.</p>
        <p><small>{{ error.message }}</small></p>
      </ion-text>
    </div>

    <!-- Grilla de Espacios 2x3 -->
    <div *ngIf="!isLoading && !error" class="zones-grid">
      <div class="room-outline">
        <div class="grid-container">
          <ng-container *ngFor="let zone of zoneGrid; let i = index">
            <div
              class="grid-item"
              [class.selected]="zone.workspace && isWorkspaceSelected(zone.workspace.id_workspace)"
              [class.disabled]="isWorkspaceDisabled(zone.workspace)"
              (click)="zone.workspace && !isWorkspaceDisabled(zone.workspace) && toggleWorkspace(zone.workspace.id_workspace)"
            >
              <div class="zone-label">{{ zone.displayName }}</div>

              <div *ngIf="zone.workspace" class="space-content">
                <h3>{{ zone.workspace.name }}</h3>
                <p class="occupancy">Aforo máximo: {{ zone.workspace.max_occupancy }}</p>

                <ion-button
                  fill="outline"
                  size="small"
                  (click)="showWorkspaceDetails(zone.workspace); $event.stopPropagation()"
                  [disabled]="isWorkspaceDisabled(zone.workspace)"
                  class="details-btn"
                >
                  <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                  Ver detalles
                </ion-button>
              </div>

              <div *ngIf="!zone.workspace" class="space-empty">
                <p>Sin espacio asignado</p>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Área de líderes: rectángulo ubicado debajo de los espacios seleccionables -->
    <div class="leaders-rect">
      <div class="leaders-label">Área de líderes</div>
      <div class="leaders-sub">Espacio reservado</div>
    </div>

    <!-- Botón de Confirmación debajo del contorno -->
    <div class="confirm-button-container">
      <ion-button
        expand="block"
        color="primary"
        [disabled]="isConfirmDisabled()"
        (click)="confirmarSeleccion()"
      >
        Confirmar Selección ({{ selectedWorkspaces.size }} seleccionado)
      </ion-button>
    </div>
    </div>
  </div>
</ion-content>

